# オセロAI プロジェクト設計書

TD(λ)-Leafによる自己学習を用いた高性能オセロAIの完全設計仕様

---

## プロジェクト概要

### 目標
パターン評価に基づくTD(λ)-Leaf学習により、100万局の自己対戦で強力なオセロAIを構築する。

### 主要技術
- **BitBoard**: 高速な盤面表現
- **パターン評価**: 14パターン × 30ステージ × 対称性活用
- **MTD(f)探索**: 反復深化による効率的な探索
- **TD(λ)-Leaf**: Eligibility Traceを用いた強化学習
- **Adamオプティマイザ**: 動的学習率による安定した学習

### 実装環境
- **言語**: Rust (コア) + Python (学習制御)
- **プラットフォーム**: OCI Always Free (ARM64, 4コア, 24GB)
- **学習時間**: 約50-60時間（2.5日）

---

## ドキュメント構成

本プロジェクトの設計書は以下の4つのドキュメントで構成されています：

### 📘 [01_design_overview.md](./01_design_overview.md)
**全体設計仕様書** - プロジェクトの全体像

- アーキテクチャ概要
- パターン評価システム
- 探索アルゴリズム
- 学習アルゴリズム
- 自己対戦設定
- メモリ使用量
- 開発フェーズ

**対象読者**: プロジェクト全体を理解したい人、設計意図を知りたい人

---

### 🔧 [02_technical_specs.md](./02_technical_specs.md)
**技術詳細仕様書** - 実装レベルの詳細

- BitBoard実装の詳細
- パターン抽出アルゴリズム
- 評価関数の実装
- MTD(f)探索の完全な実装
- TD(λ)-Leaf学習の詳細
- Adamオプティマイザ
- Python連携（PyO3）
- 最適化ポイント

**対象読者**: 実装を担当するエンジニア、詳細な動作を理解したい人

---

### 📊 [03_parameters.md](./03_parameters.md)
**パラメータ一覧** - 全ての設定値

- パターン定義
- スコア表現
- 学習パラメータ
- 探索パラメータ
- メモリ使用量
- 時間見積もり
- ファイルパス
- 全ての定数・閾値

**対象読者**: 実装時に素早くパラメータを参照したい人、設定を調整したい人

---

### ⚡ [04_quick_reference.md](./04_quick_reference.md)
**実装クイックリファレンス** - 主要アルゴリズムの疑似コード

- 主要データ構造
- 核心アルゴリズム（疑似コード）
- 重要な変換関数
- 制御フロー
- BitBoard操作
- デバッグ用チェックリスト
- 実装順序

**対象読者**: 実装中に素早くアルゴリズムを確認したい人

---

## パターン定義ファイル

設計書の参照用として、以下のファイルもご確認ください：

- **patterns.md**: パターン定義の詳細説明
- **patterns.csv**: パターン定義のCSV形式

---

## 主要な設計決定

### 1. パターン評価
- **14パターン**: 角周辺・辺・対角線を網羅
- **30ステージ**: 2手ごとの細かい分割
- **対称性**: 回転4方向、テーブル共有で省メモリ

### 2. 学習方式
- **TD(λ=0.3)-Leaf**: 葉評価と最終結果のバランス
- **Adam**: 学習率α=0.025、動的調整
- **100万局**: 約33.6億回の更新

### 3. 探索
- **MTD(f) + 反復深化**: 15ms/手
- **置換表**: 128-256MB
- **完全読み**: 残り14手から

### 4. 自己対戦
- **ε-greedy**: 段階的に探索から活用へ
  - 0-30万局: ε=0.15
  - 30-70万局: ε=0.05
  - 70-100万局: ε=0.0

---

## メモリ使用量サマリ

```
パターンテーブル:    57 MB
Adam状態:           228 MB (m: 114 MB, v: 114 MB)
置換表:         128-256 MB
────────────────────────────
合計:           413-541 MB
```

OCI Always Free (24GB) で十分な余裕あり。

---

## 学習時間見積もり

```
目標:     100万局
総手数:   約6,000万手
探索:     15ms/手（平均）
並列度:   4コア

理論時間: 62.5時間
実効時間: 50-60時間（約2.5日）
```

月間利用時間（720時間）の約8%のみ使用。

---

## 実装の流れ

### Phase 1: 基礎実装（1-2週間）
- BitBoard
- パターン抽出
- 基本評価関数

### Phase 2: 探索実装（1-2週間）
- AlphaBeta
- 置換表
- MTD(f)
- Move Ordering

### Phase 3: 学習実装（1週間）
- TD(λ)-Leaf
- Adam
- 自己対戦

### Phase 4: 統合・調整（1週間）
- Python連携
- チェックポイント
- ログ・監視

### Phase 5: 学習実行（2.5日）
- 100万局学習
- 結果分析

---

## 成功の指標

### 技術指標
- ✅ 学習完了: 100万局
- ✅ 平均更新回数: 200回以上/エントリ
- ✅ 探索速度: 15ms/手以内
- ✅ メモリ使用: 600MB以内

### 性能指標
- ✅ ランダムプレイヤーに対する勝率: 99%以上
- ✅ 簡易評価関数に対する勝率: 90%以上

---

## 想定プロジェクト構造

```
othello-ai/
├── README.md
├── Cargo.toml
├── pyproject.toml
│
├── docs/                           # 本ドキュメント群
│   ├── 01_design_overview.md
│   ├── 02_technical_specs.md
│   ├── 03_parameters.md
│   └── 04_quick_reference.md
│
├── data/                           # パターン定義
│   ├── patterns.md
│   └── patterns.csv
│
├── src/                            # Rustコア実装
│   ├── lib.rs
│   ├── board.rs                    # BitBoard
│   ├── pattern.rs                  # パターン抽出
│   ├── evaluator.rs                # 評価関数
│   ├── search.rs                   # MTD(f)探索
│   ├── td_learn.rs                 # TD学習
│   ├── adam.rs                     # Adam
│   └── python.rs                   # PyO3
│
├── python/                         # Python学習環境
│   ├── train.py                    # メイン学習
│   ├── monitor.py                  # 監視
│   └── evaluate.py                 # 評価
│
├── checkpoints/                    # チェックポイント
│   ├── checkpoint_000000.bin
│   ├── checkpoint_100000.bin
│   └── ...
│
├── logs/                           # ログファイル
└── models/                         # 最終モデル
```

---

## 開発の注意点

### デバッグ時のチェックポイント
1. **BitBoard操作**: 初期盤面が正しく表現されているか
2. **パターン抽出**: 4方向で異なるインデックスが生成されるか
3. **評価値**: 対称な局面で評価値が一致するか
4. **探索**: 完全読み可能な局面で正解が出るか
5. **TD更新**: 学習が進むにつれて評価値が収束するか

### よくある問題
- インデックス計算の誤り（3進数変換）
- 白黒反転の実装ミス（90°/270°）
- 置換表のハッシュ衝突
- Adam状態の同期問題

---

## 拡張性

本設計は以下の拡張に対応可能：

### パラメータ調整
- λ値の変更
- 学習率の調整
- 探索時間の変更
- パターン追加/削除

### アルゴリズム改善
- NegaScoutへの移行
- より深い完全読み
- 並列探索
- 選択的探索

### 環境対応
- より大きなインスタンス
- 複数マシン分散学習
- GPU活用（将来）

---

## ライセンスと利用

（プロジェクトのライセンスを記載）

---

## 連絡先

（開発者の連絡先を記載）

---

## バージョン履歴

### v1.0 - 2025-11-16
- 初版設計書作成
- 全仕様確定
- 実装準備完了

---

**このREADMEから始めて、必要に応じて各詳細ドキュメントを参照してください。**

実装の成功を祈っています！
